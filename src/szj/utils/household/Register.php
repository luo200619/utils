<?php
 namespace szj\utils\household;  Class Register{  Public static function HouseIndexEntry($info = []){ try{ $result = []; $baseinfo = self::HouseIndexHandler($info['content']['value']); $extendinfo = self::secondMatchHandler($info['type']['value']); $result = array_merge($baseinfo,$extendinfo); return appResult('户口本识别成功',$result,false); } catch (\Exception $err){ return appResult($err->getMessage()); } }  Private static function HouseIndexHandler($content = ''){ $reg = '/姓名(.*)?住址(.*)/'; $arr = []; $result = []; preg_match($reg,$content,$arr); if(!empty($arr) && count($arr) >=2 && !empty($arr[1])){ $result['username'] = preg_replace("/\\d+/",'', $arr[1]); $result['address'] = $arr[2]; } else { $result = self::firstMatchHandler(str_replace('住址','',$content)); } return $result; }  Private static function secondMatchHandler($content = ''){ $reg = '/\d{1,}/'; preg_match_all($reg,$content,$arr); $result = ['hold'=>'','number'=>'']; try{ if(!empty($content) && !empty($arr) && !empty($arr[0])){ $houseNum = $arr[0][count($arr[0])-1]; $household = preg_replace("/\d+/",'',str_replace(['户别','户号','别',$houseNum],'',$content)); $result = ['hold'=>self::typeMatchHandler($household),'number'=>$houseNum]; } } catch(\Exception $err){} return $result; }  Private static function typeMatchHandler($name = ''){ $arr = ['非农业户口','非农业家庭户','农业户口','城镇居民户口','居民户口','农业家庭户口','家庭户','农业家庭','农业户口'=>'农业','家庭户口'=>'庭户']; $result = $name; foreach($arr as $key=>$val){ if(mb_stripos($name,$val) !== false){ $result = is_numeric($key)?$val:$key; break; } } return $result; }  Private static function firstMatchHandler($content = ''){ $reg = '/((.*)省|(.*)市|(.*)县|(.*)区|(.*)镇|(.*)乡|(.*)村)/'; $arr = []; preg_match($reg,$content,$arr); $result = ['username'=>'','address'=>'']; try{ if(!empty($content) && !empty($arr) && !empty($arr[1])){ $reg = '/姓名(.*)(.*?(省|市|县|区|乡|镇|村))/'; preg_match($reg,$arr[1],$match); if(!empty($match) && count($match) >= 2){ $username = mb_substr($match[1],0,3); $end = str_replace($arr[1],'',$content); $address = preg_replace("/\\d+/",'',str_replace($username,'',$match[1]).$match[2]).$end; } else { $username = mb_substr($arr[1],0,3); $address = str_replace($arr[1],'',$content); } $result['username'] = preg_replace("/\\d+/",'', $username); $tmp = mb_substr($address,0,1); $replacearr = ['住','址']; if(in_array($tmp, $replacearr)){ $result['address'] = mb_substr($address,1); } else { $result['address'] = $address; } } } catch(\Exception $err){} return $result; } }