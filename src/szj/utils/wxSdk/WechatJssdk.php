<?php
 namespace szj\utils\wxSdk;  Class WechatJssdk {  Protected static $getTicketURL = 'https://api.weixin.qq.com/cgi-bin/ticket/getticket?type=jsapi&access_token=%s';  Protected static function getJsApiTicket($config = []){ if(empty($config)) return appResult('请传入配置参数'); $ticket = \think\facade\Cache::get($config['appid'].'wechatjssdk'); if(empty($ticket)){ try{ $resultJson = curl_get(sprintf(self::$getTicketURL,getAccessToken())); $data = json_decode($resultJson,true); if(!empty($data['ticket'])) $ticket = $data['ticket']; if (!empty($ticket)) { \think\facade\Cache::set($config['appid'].'wechatjssdk',$ticket); } } catch(\Exception $err){ return appResult($err->getMessage()); } } return empty($ticket)?appResult('未查到相关的ticket'):appResult('SUCCESS',$ticket,false); }  Public static function getSign($config = [],$options = []){ if(empty($config)) return appResult('请输入参数appid'); $data = array_merge($config,$options); $ticketData = self::getJsApiTicket($data); if($ticketData['err']) return $ticketData; $protocol = (!empty($_SERVER['HTTPS']) && $_SERVER['HTTPS'] !== 'off' || $_SERVER['SERVER_PORT'] == 443) ? "https://" : "http://"; $url = $protocol.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI']; if(!isset($data['nonceStr'])) $data['nonceStr'] = \szj\utils\wxSdk\WechatPay::getRandStr(16); if(!isset($data['timestamp'])) $data['timestamp'] = szjTime(); if(!isset($data['url'])) $data['url'] = $url; if(!isset($data['rawString'])) $data['rawString'] = 'jsapi_ticket='.$ticketData['data'].'&noncestr='.$data['nonceStr'].'&timestamp='.$data['timestamp'].'&url='.$data['url']; $signPackage = [ 'appId'=>$data['appid'],'nonceStr'=>$data['nonceStr'],'timestamp'=>$data['timestamp'],'url'=>$data['url'],'signature'=>sha1($data['rawString']),'rawString'=>$data['rawString'] ]; return appResult('SUCCESS',$signPackage,false); }  Protected static function ConfigHanadle($config = []){ $data = []; $callback = function($val,$key) use(&$data){ $data[strtolower($key)] = $val; }; array_walk($config, $callback); return $data; } }